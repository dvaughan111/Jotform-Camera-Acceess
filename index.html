<style>
  #camera {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #video {
    width: 100%;
    max-width: 400px;
    border: 2px solid #ccc;
    border-radius: 8px;
    margin-bottom: 10px;
  }

  #capture {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    background-color: #4CAF50;
    color: #fff;
    font-size: 14px;
    cursor: pointer;
    margin-bottom: 20px;
  }

  #gallery {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }

  #gallery img {
    width: 100px;
    height: auto;
    margin: 5px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
</style>

<div id="camera">
  <video id="video" autoplay></video>
  <button id="capture">Capture Photo</button>
</div>

<div id="gallery"></div>

<script>
  let video = document.getElementById('video');
  let captureBtn = document.getElementById('capture');
  let gallery = document.getElementById('gallery');
  let capturedPhotos = [];

  // Start camera
  navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
    video.srcObject = stream;
  }).catch(err => {
    console.error('Could not access camera:', err);
  });

  // Capture button
  captureBtn.addEventListener('click', capturePhoto);

  function capturePhoto() {
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    canvas.toBlob(blob => {
      // Display preview thumbnail in gallery
      const imgURL = URL.createObjectURL(blob);
      const img = document.createElement('img');
      img.src = imgURL;
      gallery.appendChild(img);

      // Upload to Jotform as a real file
      uploadToJotform(blob);
    }, 'image/jpeg', 0.95);
  }

  function uploadToJotform(blob) {
    if (typeof JFCustomWidget === 'undefined') {
      console.error('JFCustomWidget not available.');
      return;
    }

    const fileName = 'photo_' + Date.now() + '.jpg';

    // Upload to Jotform
    JFCustomWidget.uploadFile(blob, fileName, function(response) {
      console.log('File uploaded to Jotform:', response);

      // Keep track of all uploaded file URLs
      capturedPhotos.push(response.filePath);

      // Send all file URLs back to Jotform widget value
      JFCustomWidget.sendData({
        value: capturedPhotos.join('\n'),
        valid: true
      });
    });
  }
</script>
