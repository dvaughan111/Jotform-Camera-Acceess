<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Camera Upload Widget</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f9f9f9;
  padding: 20px;
  text-align: center;
}

video, canvas {
  max-width: 100%;
  border-radius: 8px;
}

button {
  background-color: #4c6ef5;
  color: #fff;
  border: none;
  padding: 10px 16px;
  margin: 6px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#instantUpload {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 15px;
  gap: 8px;
}

#instantUpload .thumb img {
  width: 120px;
  height: auto;
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video><br>
<canvas id="photoCanvas" style="display:none;"></canvas><br>

<button id="startCamera">Start Camera</button>
<button id="capturePhoto" disabled>Capture Photo</button>

<div id="instantUpload"></div>

<script>
// === CONFIG ===
const cloudName = "YOUR_CLOUD_NAME"; // e.g. du0puu5mt
const uploadPreset = "YOUR_UPLOAD_PRESET"; // must be unsigned preset

// === Elements ===
const video = document.getElementById('camera');
const canvas = document.getElementById('photoCanvas');
const startCameraBtn = document.getElementById('startCamera');
const capturePhotoBtn = document.getElementById('capturePhoto');
const instantUploadDiv = document.getElementById('instantUpload');

let stream;

// Start camera
startCameraBtn.addEventListener('click', async () => {
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    capturePhotoBtn.disabled = false;
  } catch (err) {
    alert('Camera error: ' + err.message);
  }
});

// Capture and upload photo
capturePhotoBtn.addEventListener('click', () => {
  if (!stream) return;

  const ctx = canvas.getContext('2d');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);

  canvas.toBlob(async (blob) => {
    if (!blob) return;

    const formData = new FormData();
    formData.append('file', blob, 'photo.jpg');
    formData.append('upload_preset', uploadPreset);

    try {
      const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
        method: 'POST',
        body: formData
      });
      const data = await res.json();
      if (data.secure_url) {
        addThumbnail(data.secure_url);
      } else {
        console.error('Cloudinary error', data);
        alert('Upload failed.');
      }
    } catch (err) {
      console.error(err);
      alert('Upload error.');
    }
  }, 'image/jpeg');
});

function addThumbnail(url) {
  const thumb = document.createElement('div');
  thumb.className = 'thumb';
  thumb.innerHTML = `<img src="${url}" alt="photo">`;
  instantUploadDiv.appendChild(thumb);
}
</script>

</body>
</html>
